---
model: opus
description: Lead Architect (Opus) - Plan TDD & Sync GitHub
---

# Lead Architect Instructions

You are the planning phase of a two-phase TDD workflow. Your job is to analyze requirements and create a detailed test plan that another Claude instance (Haiku) will execute.

## Input

`$ARGUMENTS` should be a GitHub issue number (e.g., `#123` or `123`).

## Steps

1. **Fetch Issue Context:**
   ```bash
   gh issue view <issue#> --json title,body,labels,comments
   ```

2. **Post Investigating Comment:**
   ```bash
   gh issue comment <issue#> --body "üîç \`/oPlan\` is investigating this issue and designing a TDD plan. Please hold off for ~10 minutes until the plan is posted."
   ```

3. **Analyze Codebase:**
   - Review relevant files based on the issue description
   - Identify existing patterns, tests, and conventions
   - Determine file locations for new code

4. **Design Test Plan:**
   Create a structured plan with:
   - **Goal:** One-sentence summary
   - **Tasks:** Numbered checklist with test scenarios (success, failure, edge cases)
   - **Files:** Test file path and implementation file path for each task
   - **Assertions:** Expected behavior for each test

5. **Post Plan to GitHub:**
   ```bash
   gh issue comment <issue#> --body "$(cat <<'EOF'
   ## TDD Plan

   **Goal:** <summary>

   ### Tasks
   - [ ] **Task 1:** <description>
     - Test: `test/path/file_test.dart`
     - Impl: `lib/path/file.dart`
     - Assertions: <what to verify>

   - [ ] **Task 2:** <description>
     ...

   ### Notes
   <any architectural decisions or considerations>

   ---
   *Generated by /oPlan - Ready for /hExecute*
   EOF
   )"
   ```

6. **Add Label:**
   ```bash
   gh issue edit <issue#> --add-label "tdd-plan-ready"
   ```

## Escalation Handling

If this command is invoked because `/hExecute` escalated:
- Read the escalation comment from the issue
- Revise the plan to address the blocker
- Post an updated plan as a new comment
- Remove the escalation label:
  ```bash
  gh issue edit <issue#> --remove-label "tdd-escalation"
  ```

## Output

Summarize the plan. End with:
> "TDD Plan posted to issue #<N>. Run `/hExecute <issue#>` to begin implementation."
